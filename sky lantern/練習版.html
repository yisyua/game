<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>å¤©ç‡ˆé»æ“ŠéŠæˆ² - é»æ“ŠæŒ‘æˆ°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }
        body {
            font-family: 'Microsoft JhengHei', 'Noto Sans TC', sans-serif;
            /* æš—è‰²æ˜Ÿç©ºæ¼¸å±¤ï¼šæ·±è—ã€è—ç´«ã€ç´«ç´… */
            background: linear-gradient(
                135deg, 
                #1a1a2e 0%, 
                #16213e 25%, 
                #0f3460 50%, 
                #533483 75%, 
                #e94057 100%
            );
            background-attachment: fixed;
            overflow: hidden;
            height: 100vh;
            user-select: none;
            position: relative;
        }
        /* --- æ˜Ÿç©ºç²’å­æ•ˆæœ --- */

 .floating-particles {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1;
    }

    .particle-bg {
        position: absolute;
        width: 3px;
        height: 3px;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.3));
        box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
        /* ä¿®æ­£é»ï¼šçµåˆ float (ä¸Šå‡) å’Œ twinkle (é–ƒçˆ) å‹•ç•« */
        animation: 
            float 15s ease-in-out infinite,
            twinkle 2s ease-in-out infinite alternate; 
        /* ç§»é™¤ opacity: 0; è®“ç²’å­åœ¨é–‹å§‹æ™‚å°±å¯è¦‹ */
    }

    /* ç²’å­å‹•ç•«ï¼šå¾åº•éƒ¨å‡èµ·ä¸¦æ¶ˆé€ */
    @keyframes float {
        /* ä¿®æ­£é»ï¼šèª¿æ•´ 0% çš„ opacity è®“æ˜Ÿæ˜Ÿåœ¨ç•«é¢ä¸Šå¯ä»¥é–ƒçˆå‡ºç¾ */
        0% { transform: translateY(100vh) scale(0.5); opacity: 0.2; }
        50% { transform: translateY(50vh) scale(1); opacity: 0.8; }
        100% { transform: translateY(-20vh) scale(0.5); opacity: 0; }
    }
    
    /* æ–°å¢çš„é–ƒçˆå‹•ç•« */
    @keyframes twinkle {
        0%, 100% { 
            opacity: 0.8; 
            transform: scale(1);
        }
        50% { 
            opacity: 0.3; /* é™ä½é€æ˜åº¦æ¨¡æ“¬é–ƒçˆ */
            transform: scale(0.5); /* ç¸®å°æ¨¡æ“¬äº®åº¦é™ä½ */
        }
    }
        #gameCanvas {
            display: block;
            width: 100vw;
            height: 100vh;
            touch-action: none;
            position: relative;
            z-index: 10;
            cursor: pointer;
        }

        /* éŠæˆ²ä»‹é¢ */
        .game-ui {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
            padding: 15px;
        }

        .hud {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 20px;
            border: 2px solid rgba(255, 215, 0, 0.4);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            text-align: center;
            max-width: 400px;
            margin: 0 auto;
        }

        .stat {
            color: #fff;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #ffd700;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .stat-value {
            font-size: 1.8rem;
            color: #ffffff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* ç‰¹æ•ˆ */
        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #ffd700;
            border-radius: 50%;
            animation: sparkle 1.2s ease-out forwards;
        }

        @keyframes sparkle {
            0% {
                transform: scale(0) rotate(0deg);
                opacity: 1;
            }
            50% {
                transform: scale(1) rotate(180deg);
                opacity: 0.8;
            }
            100% {
                transform: scale(0.5) rotate(360deg) translateY(-80px);
                opacity: 0;
            }
        }

        .score-popup {
            position: absolute;
            color: #ffd700;
            font-size: 1.8rem;
            font-weight: bold;
            pointer-events: none;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);
            z-index: 30;
            animation: scoreFloat 1.5s ease-out forwards;
        }

        @keyframes scoreFloat {
            0% {
                transform: translateY(0) scale(0.5);
                opacity: 1;
            }
            50% {
                transform: translateY(-40px) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(1);
                opacity: 0;
            }
        }

        /* éŠæˆ²çµæŸç•«é¢ */
        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            color: white;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            z-index: 200;
            border: 3px solid #ffd700;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.6);
            max-width: 500px;
            width: 90%;
        }

        .game-over h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .game-over .final-stats {
            font-size: 1.5rem;
            margin: 15px 0;
            line-height: 1.6;
            text-align: left;
        }

        .restart-btn {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: white;
            border: none;
            padding: 15px 35px;
            font-size: 1.2rem;
            border-radius: 12px;
            cursor: pointer;
            margin-top: 25px;
            font-weight: bold;
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4);
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .restart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.6);
        }

        /* è§¸æ§åé¥‹ */
        .canvas-touch-feedback {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 215, 0, 0.3);
            border: 2px solid rgba(255, 215, 0, 0.6);
            pointer-events: none;
            z-index: 20;
            animation: touchRipple 0.6s ease-out forwards;
        }

        @keyframes touchRipple {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        .instructions {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: rgba(255, 255, 255, 0.9);
            padding: 12px 20px;
            border-radius: 20px;
            font-size: 0.9rem;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 15;
            max-width: 90%;
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #ffd700;
            font-size: 1.5rem;
            text-align: center;
            z-index: 100;
        }

        @media (max-width: 768px) {
            .hud {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 15px;
                margin: 0 10px;
            }
            .stat-value {
                font-size: 1.5rem;
            }
            .game-over {
                padding: 30px 20px;
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <div class="floating-particles">
        <div class="particle-bg" style="top: 10%; left: 20%; animation-delay: 1s; animation-duration: 12s;"></div>
        <div class="particle-bg" style="top: 50%; left: 80%; animation-delay: 3s; animation-duration: 18s;"></div>
        <div class="particle-bg" style="top: 30%; left: 5%; animation-delay: 5s; animation-duration: 14s;"></div>
        <div class="particle-bg" style="top: 70%; left: 45%; animation-delay: 7s; animation-duration: 16s;"></div>
        <div class="particle-bg" style="top: 5%; left: 60%; animation-delay: 9s; animation-duration: 20s;"></div>
        <div class="particle-bg" style="top: 85%; left: 15%; animation-delay: 2s; animation-duration: 13s;"></div>
        <div class="particle-bg" style="top: 40%; left: 95%; animation-delay: 4s; animation-duration: 17s;"></div>
        <div class="particle-bg" style="top: 20%; left: 35%; animation-delay: 6s; animation-duration: 15s;"></div>
        <div class="particle-bg" style="top: 65%; left: 70%; animation-delay: 8s; animation-duration: 19s;"></div>
        <div class="particle-bg" style="top: 90%; left: 55%; animation-delay: 10s; animation-duration: 11s;"></div>
    </div>

    <canvas id="gameCanvas"></canvas>
    
    <div class="game-ui">
        <div class="hud">
            <div class="stat">
                <div class="stat-label">ğŸ’¯ åˆ†æ•¸</div>
                <div class="stat-value" id="scoreValue">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">ğŸ¯ ç›®æ¨™</div>
                <div class="stat-value"><span id="hitValue">0</span> / 5</div>
            </div>
        </div>
    </div>
    
    <div class="instructions">
        é»æ“Š 5 å€‹å¤©ç‡ˆä¾†å®ŒæˆéŠæˆ²ï¼
    </div>
    
    <div class="loading" id="loadingScreen">
        <p>æ­£åœ¨è¼‰å…¥éŠæˆ²...</p>
    </div>

<script>
    class SkyLanternGame {
        constructor() {
            this.canvas = document.getElementById('gameCanvas');
            this.ctx = this.canvas.getContext('2d');
            this.resizeCanvas();
            this.loadingScreen = document.getElementById('loadingScreen');

            this.lanterns = [];
            this.score = 0;
            this.gameRunning = false;
            this.hitLanterns = 0;
            this.totalLanterns = 0;

            this.lanternImages = [];

            this.initEvents();
            this.loadLanternImages();
        }

        createFallbackLantern() {
            const canvas = document.createElement('canvas');
            canvas.width = 80;
            canvas.height = 100;
            const ctx = canvas.getContext('2d');

            const colors = ['#ff6b6b', '#feca57', '#00bfff', '#9b59b6', '#32cd32'];
            const bodyColor = colors[Math.floor(Math.random() * colors.length)];

            ctx.fillStyle = bodyColor;
            ctx.beginPath();
            ctx.moveTo(40, 0);
            ctx.quadraticCurveTo(80, 20, 80, 50);
            ctx.quadraticCurveTo(80, 80, 40, 100);
            ctx.quadraticCurveTo(0, 80, 0, 50);
            ctx.quadraticCurveTo(0, 20, 40, 0);
            ctx.closePath();
            ctx.fill();

            ctx.fillStyle = '#f7f1e3';
            ctx.fillRect(30, 95, 20, 5);

            ctx.strokeStyle = '#feca57';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(40, 100);
            ctx.lineTo(40, 105);
            ctx.stroke();

            ctx.fillStyle = '#ffed00';
            ctx.beginPath();
            ctx.arc(40, 105, 5, 0, Math.PI * 2);
            ctx.fill();

            const img = new Image();
            img.src = canvas.toDataURL();
            return img;
        }

        loadLanternImages() {
            const lanternPaths = ['picture/1.png', 'picture/2.png', 'picture/3.png', 'picture/4.png', 'picture/5.png', 'picture/6.png'];
            let loadedCount = 0;
            const totalImages = lanternPaths.length;
            
            const checkLoadStatus = () => {
                loadedCount++;
                if (loadedCount === totalImages) {
                    this.loadingScreen.style.display = 'none';
                    this.startGame();
                }
            };

            if (totalImages === 0) {
                this.lanternImages.push(this.createFallbackLantern());
                this.loadingScreen.style.display = 'none';
                this.startGame();
                return;
            }

            lanternPaths.forEach(path => {
                const img = new Image();
                img.onload = () => {
                    this.lanternImages.push(img);
                    checkLoadStatus();
                };
                img.onerror = () => {
                    this.lanternImages.push(this.createFallbackLantern());
                    checkLoadStatus();
                };
                img.src = path;
            });
        }

        resizeCanvas() {
            this.canvas.width = window.innerWidth;
            this.canvas.height = window.innerHeight;
        }

        initEvents() {
            const handleInteraction = (x, y) => {
                if (!this.gameRunning) return;
                this.createTouchFeedback(x, y);
                this.handleClick(x, y);
            };

            this.canvas.addEventListener('mousedown', (e) => {
                const rect = this.canvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                handleInteraction(x, y);
            });

            this.canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = this.canvas.getBoundingClientRect();
                const x = touch.clientX - rect.left;
                const y = touch.clientY - rect.top;
                handleInteraction(x, y);
            }, { passive: false });

            window.addEventListener('resize', () => {
                this.resizeCanvas();
            });
        }

        createTouchFeedback(x, y) {
            const feedback = document.createElement('div');
            feedback.className = 'canvas-touch-feedback';
            feedback.style.left = (x - 30) + 'px';
            feedback.style.top = (y - 30) + 'px';
            document.body.appendChild(feedback);
            
            setTimeout(() => feedback.remove(), 600);
        }

        startGame() {
            if (this.gameRunning) return;
            this.gameRunning = true;
            this.score = 0;
            this.hitLanterns = 0;
            this.totalLanterns = 0;
            
            document.getElementById('scoreValue').textContent = this.score;
            document.getElementById('hitValue').textContent = this.hitLanterns;
            
            this.startSpawning();
            this.render();
        }

        startSpawning() {
            const spawnLoop = () => {
                if (!this.gameRunning) return;
                this.spawnLantern();
                const delay = Math.random() * 800 + 600;
                this.spawnTimer = setTimeout(spawnLoop, delay);
            };
            spawnLoop();
        }

        spawnLantern() {
            const x = Math.random() * (this.canvas.width - 100) + 50;
            const y = this.canvas.height + 100;
            // èª¿æ•´å¤©ç‡ˆä¸Šå‡é€Ÿåº¦
            const speed = Math.random() * 0.5 + 0.5;

            const lanternImg = this.lanternImages[Math.floor(Math.random() * this.lanternImages.length)];

            this.lanterns.push({ 
                x, 
                y, 
                speed,
                img: lanternImg,
                isLit: false,
                scale: 0.8 + Math.random() * 0.4,
                lifetime: 0,
                rotation: 0, 
                id: this.totalLanterns,
                rotationSpeed: 0 
            });

            this.totalLanterns++;
        }

        render() {
            if (!this.gameRunning) return;

            this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

            for (let i = this.lanterns.length - 1; i >= 0; i--) {
                const l = this.lanterns[i];

                l.lifetime += 1;
                l.y -= l.speed;
                
                this.ctx.save();
                this.ctx.translate(l.x + 40 * l.scale, l.y + 50 * l.scale);
                this.ctx.rotate(l.rotation);

                if (l.isLit) {
                    this.ctx.globalAlpha = 1.0;
                    this.ctx.shadowColor = 'rgba(255, 255, 150, 0.8)';
                    this.ctx.shadowBlur = 15;
                }

                this.ctx.drawImage(l.img, -40 * l.scale, -50 * l.scale, 80 * l.scale, 100 * l.scale);

                if (!l.isLit) {
                    this.ctx.globalCompositeOperation = 'source-atop';
                    this.ctx.globalAlpha = 0.6;
                    this.ctx.fillStyle = 'rgba(50, 50, 80, 0.7)';
                    this.ctx.fillRect(-40 * l.scale, -50 * l.scale, 80 * l.scale, 100 * l.scale);
                }

                this.ctx.globalCompositeOperation = 'source-over';
                this.ctx.restore();

                if (l.y < -150) {
                    this.lanterns.splice(i, 1);
                }
            }

            requestAnimationFrame(() => this.render());
        }

        handleClick(x, y) {
            if (!this.gameRunning) return;

            for (let i = this.lanterns.length - 1; i >= 0; i--) {
                const l = this.lanterns[i];
                const hitboxSize = 80 * l.scale;
                const hitboxHeight = 100 * l.scale;
                
                if (x >= l.x && x <= l.x + hitboxSize && 
                    y >= l.y && y <= l.y + hitboxHeight && !l.isLit) {
                    
                    l.isLit = true;
                    this.hitLanterns++;
                    
                    const points = 10;
                    this.score += points;
                    
                    document.getElementById('scoreValue').textContent = this.score;
                    document.getElementById('hitValue').textContent = this.hitLanterns;

                    this.showScorePopup(l.x + hitboxSize/2, l.y + hitboxHeight/2, points);
                    this.createExplosion(l.x + hitboxSize/2, l.y + hitboxHeight/2);
                    
                    // æª¢æŸ¥æ˜¯å¦é”åˆ°ç›®æ¨™ï¼Œç„¶å¾ŒçµæŸéŠæˆ²
                    if (this.hitLanterns >= 5) {
                        this.endGame();
                    }
                    
                    break;
                }
            }
        }

        showScorePopup(x, y, points) {
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = `+${points}`;
            popup.style.left = x + 'px';
            popup.style.top = y + 'px';
            document.body.appendChild(popup);
            
            setTimeout(() => popup.remove(), 1500);
        }

        createExplosion(x, y) {
            const colors = ['#ffd700', '#ff6347', '#ff69b4', '#00bfff', '#32cd32'];
            
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                particle.style.transform = `rotate(${i * 45}deg)`;
                document.body.appendChild(particle);
                
                setTimeout(() => particle.remove(), 1200);
            }
        }

        endGame() {
            this.gameRunning = false;
            if (this.spawnTimer) clearTimeout(this.spawnTimer);
            
            this.showGameOverScreen();
        }

        showGameOverScreen() {
            localStorage.setItem("score",this.score);
            localStorage.setItem("count",this.hitLanterns);
            window.location.href = "gameover1.html";
        }
    }

    // å•Ÿå‹•éŠæˆ²
    document.addEventListener('DOMContentLoaded', () => {
        try {
            new SkyLanternGame();
        } catch (err) {
            console.error('âŒ éŠæˆ²å•Ÿå‹•å¤±æ•—ï¼š', err);
            alert('éŠæˆ²å•Ÿå‹•å¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢');
        }
    });

    // é˜²æ­¢é é¢æ»¾å‹•å’Œç¸®æ”¾
    document.addEventListener('touchmove', (e) => {
        e.preventDefault();
    }, { passive: false });

    document.addEventListener('gesturestart', (e) => {
        e.preventDefault();
    });
</script>
</body>
</html>